"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var page_1 = require("../models/page");
var fileSystem = require("file-system");
var image = require("image-source");
var PageService = (function () {
    function PageService() {
    }
    PageService.prototype.getPage = function (id) {
        var pages = this.getPages();
        var index = this.findPageIndex(pages, id);
        if (index === -1)
            return null;
        return pages[index];
    };
    PageService.prototype.getPages = function () {
        var file = fileSystem.knownFolders.documents().getFile("scrapbook.json");
        var pages = file.readTextSync().length === 0
            ? new Array()
            : JSON.parse(file.readTextSync());
        pages.forEach(function (page) {
            page.Image = image.fromBase64(page.ImageBase64);
        });
        return pages;
    };
    PageService.prototype.savePage = function (scrapbookPage) {
        var file = fileSystem.knownFolders.documents().getFile("scrapbook.json");
        var pages = this.getPages();
        var index = this.findPageIndex(pages, scrapbookPage.Id);
        var page = new page_1.Page();
        page.Id = scrapbookPage.Id;
        page.Title = scrapbookPage.Title;
        page.Gender = scrapbookPage.Gender;
        page.Age = scrapbookPage.Age;
        page.BirthDate = scrapbookPage.BirthDate;
        page.ImageBase64 = scrapbookPage.ImageBase64;
        page.Lat = scrapbookPage.Lat;
        page.Long = scrapbookPage.Long;
        if (index !== -1) {
            pages[index] = scrapbookPage;
        }
        else {
            pages.push(scrapbookPage);
        }
        var json = JSON.stringify(pages);
        file.writeText(json);
    };
    PageService.prototype.findPageIndex = function (pages, id) {
        return pages.findIndex(function (element) {
            return element.Id === id;
        });
    };
    return PageService;
}());
PageService = __decorate([
    core_1.Injectable()
], PageService);
exports.PageService = PageService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicGFnZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQTJDO0FBQzNDLHVDQUFzQztBQUN0Qyx3Q0FBMEM7QUFDMUMsb0NBQXNDO0FBR3RDLElBQWEsV0FBVztJQUF4QjtJQThDRyxDQUFDO0lBN0NBLDZCQUFPLEdBQVAsVUFBUSxFQUFVO1FBQ2xCLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM1QixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUMxQyxFQUFFLENBQUMsQ0FBQyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDakIsTUFBTSxDQUFDLElBQUksQ0FBQztRQUNaLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDeEIsQ0FBQztJQUNELDhCQUFRLEdBQVI7UUFDSSxJQUFJLElBQUksR0FBRyxVQUFVLENBQUMsWUFBWSxDQUFDLFNBQVMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ3pFLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQyxNQUFNLEtBQUssQ0FBQztjQUMxQyxJQUFJLEtBQUssRUFBUTtjQUNKLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUM7UUFDL0MsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFDLElBQUk7WUFDbkIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNoRCxDQUFDLENBQUMsQ0FBQztRQUVILE1BQU0sQ0FBQyxLQUFLLENBQUM7SUFDakIsQ0FBQztJQUNELDhCQUFRLEdBQVIsVUFBUyxhQUFtQjtRQUN4QixJQUFJLElBQUksR0FBRyxVQUFVLENBQUMsWUFBWSxDQUFDLFNBQVMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ3pFLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM1QixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDeEQsSUFBSSxJQUFJLEdBQUcsSUFBSSxXQUFJLEVBQUUsQ0FBQztRQUN0QixJQUFJLENBQUMsRUFBRSxHQUFHLGFBQWEsQ0FBQyxFQUFFLENBQUM7UUFDM0IsSUFBSSxDQUFDLEtBQUssR0FBRyxhQUFhLENBQUMsS0FBSyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxNQUFNLEdBQUcsYUFBYSxDQUFDLE1BQU0sQ0FBQztRQUNuQyxJQUFJLENBQUMsR0FBRyxHQUFHLGFBQWEsQ0FBQyxHQUFHLENBQUM7UUFDN0IsSUFBSSxDQUFDLFNBQVMsR0FBRyxhQUFhLENBQUMsU0FBUyxDQUFDO1FBQ3pDLElBQUksQ0FBQyxXQUFXLEdBQUcsYUFBYSxDQUFDLFdBQVcsQ0FBQztRQUM3QyxJQUFJLENBQUMsR0FBRyxHQUFHLGFBQWEsQ0FBQyxHQUFHLENBQUM7UUFDN0IsSUFBSSxDQUFDLElBQUksR0FBRyxhQUFhLENBQUMsSUFBSSxDQUFDO1FBQy9CLEVBQUUsQ0FBQyxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbkIsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLGFBQWEsQ0FBQztRQUM3QixDQUFDO1FBQ0QsSUFBSSxDQUFDLENBQUM7WUFDTixLQUFLLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQzFCLENBQUM7UUFDRCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDekIsQ0FBQztJQUNPLG1DQUFhLEdBQXJCLFVBQXNCLEtBQVUsRUFBRSxFQUFVO1FBQ3hDLE1BQU0sQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLFVBQVUsT0FBTztZQUN4QyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUM7UUFDekIsQ0FBQyxDQUFDLENBQUM7SUFDSCxDQUFDO0lBQ0Ysa0JBQUM7QUFBRCxDQUFDLEFBOUNKLElBOENJO0FBOUNTLFdBQVc7SUFEdkIsaUJBQVUsRUFBRTtHQUNBLFdBQVcsQ0E4Q3BCO0FBOUNTLGtDQUFXIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQgeyBQYWdlIH0gZnJvbSBcIi4uL21vZGVscy9wYWdlXCI7XG5pbXBvcnQgKiBhcyBmaWxlU3lzdGVtIGZyb20gXCJmaWxlLXN5c3RlbVwiO1xuaW1wb3J0ICogYXMgaW1hZ2UgZnJvbSBcImltYWdlLXNvdXJjZVwiO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgUGFnZVNlcnZpY2Uge1xuICAgIGdldFBhZ2UoaWQ6IG51bWJlcik6IFBhZ2Uge1xuICAgIGxldCBwYWdlcyA9IHRoaXMuZ2V0UGFnZXMoKTtcbiAgICBsZXQgaW5kZXggPSB0aGlzLmZpbmRQYWdlSW5kZXgocGFnZXMsIGlkKTtcbiAgICBpZiAoaW5kZXggPT09IC0xKVxuICAgIHJldHVybiBudWxsO1xuICAgIHJldHVybiBwYWdlc1tpbmRleF07XG59XG5nZXRQYWdlcygpOiBBcnJheTxQYWdlPiB7XG4gICAgbGV0IGZpbGUgPSBmaWxlU3lzdGVtLmtub3duRm9sZGVycy5kb2N1bWVudHMoKS5nZXRGaWxlKFwic2NyYXBib29rLmpzb25cIik7XG4gICAgbGV0IHBhZ2VzID0gZmlsZS5yZWFkVGV4dFN5bmMoKS5sZW5ndGggPT09IDBcbiAgICA/IG5ldyBBcnJheTxQYWdlPigpXG4gICAgOiA8QXJyYXk8UGFnZT4+SlNPTi5wYXJzZShmaWxlLnJlYWRUZXh0U3luYygpKTtcbiAgICBwYWdlcy5mb3JFYWNoKChwYWdlKSA9PiB7XG4gICAgcGFnZS5JbWFnZSA9IGltYWdlLmZyb21CYXNlNjQocGFnZS5JbWFnZUJhc2U2NCk7XG4gICAgfSk7XG4gICBcbiAgICByZXR1cm4gcGFnZXM7XG59XG5zYXZlUGFnZShzY3JhcGJvb2tQYWdlOiBQYWdlKTogdm9pZCB7XG4gICAgbGV0IGZpbGUgPSBmaWxlU3lzdGVtLmtub3duRm9sZGVycy5kb2N1bWVudHMoKS5nZXRGaWxlKFwic2NyYXBib29rLmpzb25cIik7XG4gICAgbGV0IHBhZ2VzID0gdGhpcy5nZXRQYWdlcygpO1xuICAgIGxldCBpbmRleCA9IHRoaXMuZmluZFBhZ2VJbmRleChwYWdlcywgc2NyYXBib29rUGFnZS5JZCk7XG4gICAgbGV0IHBhZ2UgPSBuZXcgUGFnZSgpO1xuICAgIHBhZ2UuSWQgPSBzY3JhcGJvb2tQYWdlLklkO1xuICAgIHBhZ2UuVGl0bGUgPSBzY3JhcGJvb2tQYWdlLlRpdGxlO1xuICAgIHBhZ2UuR2VuZGVyID0gc2NyYXBib29rUGFnZS5HZW5kZXI7XG4gICAgcGFnZS5BZ2UgPSBzY3JhcGJvb2tQYWdlLkFnZTtcbiAgICBwYWdlLkJpcnRoRGF0ZSA9IHNjcmFwYm9va1BhZ2UuQmlydGhEYXRlO1xuICAgIHBhZ2UuSW1hZ2VCYXNlNjQgPSBzY3JhcGJvb2tQYWdlLkltYWdlQmFzZTY0O1xuICAgIHBhZ2UuTGF0ID0gc2NyYXBib29rUGFnZS5MYXQ7XG4gICAgcGFnZS5Mb25nID0gc2NyYXBib29rUGFnZS5Mb25nO1xuICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICBwYWdlc1tpbmRleF0gPSBzY3JhcGJvb2tQYWdlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICBwYWdlcy5wdXNoKHNjcmFwYm9va1BhZ2UpO1xuICAgIH1cbiAgICB2YXIganNvbiA9IEpTT04uc3RyaW5naWZ5KHBhZ2VzKTtcbiAgICBmaWxlLndyaXRlVGV4dChqc29uKTtcbn1cbnByaXZhdGUgZmluZFBhZ2VJbmRleChwYWdlczogYW55LCBpZDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gcGFnZXMuZmluZEluZGV4KGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgcmV0dXJuIGVsZW1lbnQuSWQgPT09IGlkO1xuICAgIH0pO1xuICAgIH1cbiAgIH0iXX0=