"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var page_1 = require("../models/page");
var fileSystem = require("file-system");
var image = require("image-source");
var PageService = (function () {
    function PageService() {
    }
    PageService.prototype.getPage = function (id) {
        var pages = this.getPages();
        var index = this.findPageIndex(pages, id);
        if (index === -1)
            return null;
        return pages[index];
    };
    PageService.prototype.getPages = function () {
        var file = fileSystem.knownFolders.documents().getFile("scrapbook.json");
        var pages = file.readTextSync().length === 0
            ? new Array()
            : JSON.parse(file.readTextSync());
        pages.forEach(function (page) {
            page.Image = image.fromBase64(page.ImageBase64);
        });
        return pages;
    };
    PageService.prototype.savePage = function (scrapbookPage) {
        var file = fileSystem.knownFolders.documents().getFile("scrapbook.json");
        var pages = this.getPages();
        var index = this.findPageIndex(pages, scrapbookPage.Id);
        var page = new page_1.Page();
        page.Id = scrapbookPage.Id;
        page.Title = scrapbookPage.Title;
        page.Gender = scrapbookPage.Gender;
        page.Age = scrapbookPage.Age;
        page.BirthDate = scrapbookPage.BirthDate;
        page.ImageBase64 = scrapbookPage.ImageBase64;
        page.Lat = scrapbookPage.Lat;
        page.Long = scrapbookPage.Long;
        if (index !== -1) {
            pages[index] = scrapbookPage;
        }
        else {
            pages.push(scrapbookPage);
        }
        var json = JSON.stringify(pages);
        file.writeText(json);
    };
    PageService.prototype.findPageIndex = function (pages, id) {
        return pages.findIndex(function (element) {
            return element.Id === id;
        });
    };
    return PageService;
}());
PageService = __decorate([
    core_1.Injectable()
], PageService);
exports.PageService = PageService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicGFnZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQTJDO0FBQzNDLHVDQUFzQztBQUN0Qyx3Q0FBMEM7QUFDMUMsb0NBQXNDO0FBR3RDLElBQWEsV0FBVztJQUF4QjtJQThDRyxDQUFDO0lBN0NBLDZCQUFPLEdBQVAsVUFBUSxFQUFVO1FBQ2xCLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM1QixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUMxQyxFQUFFLENBQUMsQ0FBQyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDakIsTUFBTSxDQUFDLElBQUksQ0FBQztRQUNaLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDeEIsQ0FBQztJQUNELDhCQUFRLEdBQVI7UUFDSSxJQUFJLElBQUksR0FBRyxVQUFVLENBQUMsWUFBWSxDQUFDLFNBQVMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ3pFLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQyxNQUFNLEtBQUssQ0FBQztjQUMxQyxJQUFJLEtBQUssRUFBUTtjQUNKLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUM7UUFDL0MsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFDLElBQUk7WUFDbkIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNoRCxDQUFDLENBQUMsQ0FBQztRQUVILE1BQU0sQ0FBQyxLQUFLLENBQUM7SUFDakIsQ0FBQztJQUNELDhCQUFRLEdBQVIsVUFBUyxhQUFtQjtRQUN4QixJQUFJLElBQUksR0FBRyxVQUFVLENBQUMsWUFBWSxDQUFDLFNBQVMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ3pFLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM1QixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDeEQsSUFBSSxJQUFJLEdBQUcsSUFBSSxXQUFJLEVBQUUsQ0FBQztRQUN0QixJQUFJLENBQUMsRUFBRSxHQUFHLGFBQWEsQ0FBQyxFQUFFLENBQUM7UUFDM0IsSUFBSSxDQUFDLEtBQUssR0FBRyxhQUFhLENBQUMsS0FBSyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxNQUFNLEdBQUcsYUFBYSxDQUFDLE1BQU0sQ0FBQztRQUNuQyxJQUFJLENBQUMsR0FBRyxHQUFHLGFBQWEsQ0FBQyxHQUFHLENBQUM7UUFDN0IsSUFBSSxDQUFDLFNBQVMsR0FBRyxhQUFhLENBQUMsU0FBUyxDQUFDO1FBQ3pDLElBQUksQ0FBQyxXQUFXLEdBQUcsYUFBYSxDQUFDLFdBQVcsQ0FBQztRQUM3QyxJQUFJLENBQUMsR0FBRyxHQUFHLGFBQWEsQ0FBQyxHQUFHLENBQUM7UUFDN0IsSUFBSSxDQUFDLElBQUksR0FBRyxhQUFhLENBQUMsSUFBSSxDQUFDO1FBQy9CLEVBQUUsQ0FBQyxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbkIsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLGFBQWEsQ0FBQztRQUM3QixDQUFDO1FBQ0QsSUFBSSxDQUFDLENBQUM7WUFDTixLQUFLLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQzFCLENBQUM7UUFDRCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDekIsQ0FBQztJQUNPLG1DQUFhLEdBQXJCLFVBQXNCLEtBQVUsRUFBRSxFQUFVO1FBQ3hDLE1BQU0sQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLFVBQVUsT0FBTztZQUN4QyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUM7UUFDekIsQ0FBQyxDQUFDLENBQUM7SUFDSCxDQUFDO0lBQ0Ysa0JBQUM7QUFBRCxDQUFDLEFBOUNKLElBOENJO0FBOUNTLFdBQVc7SUFEdkIsaUJBQVUsRUFBRTtHQUNBLFdBQVcsQ0E4Q3BCO0FBOUNTLGtDQUFXIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IFBhZ2UgfSBmcm9tIFwiLi4vbW9kZWxzL3BhZ2VcIjtcclxuaW1wb3J0ICogYXMgZmlsZVN5c3RlbSBmcm9tIFwiZmlsZS1zeXN0ZW1cIjtcclxuaW1wb3J0ICogYXMgaW1hZ2UgZnJvbSBcImltYWdlLXNvdXJjZVwiO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgUGFnZVNlcnZpY2Uge1xyXG4gICAgZ2V0UGFnZShpZDogbnVtYmVyKTogUGFnZSB7XHJcbiAgICBsZXQgcGFnZXMgPSB0aGlzLmdldFBhZ2VzKCk7XHJcbiAgICBsZXQgaW5kZXggPSB0aGlzLmZpbmRQYWdlSW5kZXgocGFnZXMsIGlkKTtcclxuICAgIGlmIChpbmRleCA9PT0gLTEpXHJcbiAgICByZXR1cm4gbnVsbDtcclxuICAgIHJldHVybiBwYWdlc1tpbmRleF07XHJcbn1cclxuZ2V0UGFnZXMoKTogQXJyYXk8UGFnZT4ge1xyXG4gICAgbGV0IGZpbGUgPSBmaWxlU3lzdGVtLmtub3duRm9sZGVycy5kb2N1bWVudHMoKS5nZXRGaWxlKFwic2NyYXBib29rLmpzb25cIik7XHJcbiAgICBsZXQgcGFnZXMgPSBmaWxlLnJlYWRUZXh0U3luYygpLmxlbmd0aCA9PT0gMFxyXG4gICAgPyBuZXcgQXJyYXk8UGFnZT4oKVxyXG4gICAgOiA8QXJyYXk8UGFnZT4+SlNPTi5wYXJzZShmaWxlLnJlYWRUZXh0U3luYygpKTtcclxuICAgIHBhZ2VzLmZvckVhY2goKHBhZ2UpID0+IHtcclxuICAgIHBhZ2UuSW1hZ2UgPSBpbWFnZS5mcm9tQmFzZTY0KHBhZ2UuSW1hZ2VCYXNlNjQpO1xyXG4gICAgfSk7XHJcbiAgIFxyXG4gICAgcmV0dXJuIHBhZ2VzO1xyXG59XHJcbnNhdmVQYWdlKHNjcmFwYm9va1BhZ2U6IFBhZ2UpOiB2b2lkIHtcclxuICAgIGxldCBmaWxlID0gZmlsZVN5c3RlbS5rbm93bkZvbGRlcnMuZG9jdW1lbnRzKCkuZ2V0RmlsZShcInNjcmFwYm9vay5qc29uXCIpO1xyXG4gICAgbGV0IHBhZ2VzID0gdGhpcy5nZXRQYWdlcygpO1xyXG4gICAgbGV0IGluZGV4ID0gdGhpcy5maW5kUGFnZUluZGV4KHBhZ2VzLCBzY3JhcGJvb2tQYWdlLklkKTtcclxuICAgIGxldCBwYWdlID0gbmV3IFBhZ2UoKTtcclxuICAgIHBhZ2UuSWQgPSBzY3JhcGJvb2tQYWdlLklkO1xyXG4gICAgcGFnZS5UaXRsZSA9IHNjcmFwYm9va1BhZ2UuVGl0bGU7XHJcbiAgICBwYWdlLkdlbmRlciA9IHNjcmFwYm9va1BhZ2UuR2VuZGVyO1xyXG4gICAgcGFnZS5BZ2UgPSBzY3JhcGJvb2tQYWdlLkFnZTtcclxuICAgIHBhZ2UuQmlydGhEYXRlID0gc2NyYXBib29rUGFnZS5CaXJ0aERhdGU7XHJcbiAgICBwYWdlLkltYWdlQmFzZTY0ID0gc2NyYXBib29rUGFnZS5JbWFnZUJhc2U2NDtcclxuICAgIHBhZ2UuTGF0ID0gc2NyYXBib29rUGFnZS5MYXQ7XHJcbiAgICBwYWdlLkxvbmcgPSBzY3JhcGJvb2tQYWdlLkxvbmc7XHJcbiAgICBpZiAoaW5kZXggIT09IC0xKSB7XHJcbiAgICBwYWdlc1tpbmRleF0gPSBzY3JhcGJvb2tQYWdlO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICBwYWdlcy5wdXNoKHNjcmFwYm9va1BhZ2UpO1xyXG4gICAgfVxyXG4gICAgdmFyIGpzb24gPSBKU09OLnN0cmluZ2lmeShwYWdlcyk7XHJcbiAgICBmaWxlLndyaXRlVGV4dChqc29uKTtcclxufVxyXG5wcml2YXRlIGZpbmRQYWdlSW5kZXgocGFnZXM6IGFueSwgaWQ6IG51bWJlcik6IG51bWJlciB7XHJcbiAgICByZXR1cm4gcGFnZXMuZmluZEluZGV4KGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICByZXR1cm4gZWxlbWVudC5JZCA9PT0gaWQ7XHJcbiAgICB9KTtcclxuICAgIH1cclxuICAgfSJdfQ==